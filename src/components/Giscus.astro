---
/*
  This is a Giscus component to allow comment in the page
  Read more about it here: https://giscus.app/
*/
const repo = "safeamiiir/personal_blog";
const repoId = "R_kgDOKnMYzQ";
const category = "Announcements";
const categoryId = "DIC_kwDOKnMYzc4CxnRt";
---

<div class="giscus"></div>

<script
  is:inline
  src="https://giscus.app/client.js"
  data-repo={repo}
  data-repo-id={repoId}
  data-category={category}
  data-category-id={categoryId}
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="1"
  data-input-position="bottom"
  data-theme="preferred_color_scheme"
  data-lang="en"
  crossorigin="anonymous"
  async
></script>

<!-- AI Generated -->
<!-- ðŸ‘‡ This script dynamically updates the theme -->
<script is:inline>
  function setGiscusTheme() {
    const iframe = document.querySelector("iframe.giscus-frame");
    if (!iframe) return;
    const theme = document.documentElement.classList.contains("dark") ? "dark" : "light";
    iframe.contentWindow.postMessage(
      { giscus: { setConfig: { theme } } },
      "https://giscus.app"
    );
  }

  // âœ… Wait until iframe exists AND fully loaded
  function waitForGiscusIframe() {
    const iframe = document.querySelector("iframe.giscus-frame");
    if (!iframe) {
      requestAnimationFrame(waitForGiscusIframe);
      return;
    }

    // When iframe has loaded, we can safely send the message
    iframe.addEventListener("load", () => {
      setTimeout(setGiscusTheme, 100); // small delay ensures ready state in Safari
    });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", waitForGiscusIframe);
  } else {
    waitForGiscusIframe();
  }

  // âœ… Also reapply theme when class changes (theme toggle)
  const observer = new MutationObserver(() => {
    setTimeout(setGiscusTheme, 150);
  });
  observer.observe(document.documentElement, { attributes: true, attributeFilter: ["class"] });
</script>
