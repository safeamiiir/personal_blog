---
/*
  This is a Giscus component to allow comment in the page
  Read more about it here: https://giscus.app/
*/
const repo = "safeamiiir/personal_blog";
const repoId = "R_kgDOKnMYzQ";
const category = "Announcements";
const categoryId = "DIC_kwDOKnMYzc4CxnRt";
---

<div class="giscus"></div>

<script
  is:inline
  src="https://giscus.app/client.js"
  data-repo={repo}
  data-repo-id={repoId}
  data-category={category}
  data-category-id={categoryId}
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="1"
  data-input-position="bottom"
  data-theme="light"
  data-lang="en"
  data-loading="lazy"
  crossorigin="anonymous"
  async
></script>

<!-- AI Generated -->
<!-- ðŸ‘‡ This script dynamically updates the theme -->
<script is:inline>
  // Wait until the Giscus iframe is ready, then sync theme
  function updateGiscusTheme() {
    const iframe = document.querySelector("iframe.giscus-frame");
    if (!iframe) return;

    const theme = document.documentElement.classList.contains("dark") ? "dark" : "light";
    iframe.contentWindow.postMessage(
      { giscus: { setConfig: { theme } } },
      "https://giscus.app"
    );
  }

  function waitForGiscusAndUpdate() {
    const iframe = document.querySelector("iframe.giscus-frame");
    if (iframe) {
      // Wait until iframe fully loads
      iframe.addEventListener("load", updateGiscusTheme, { once: true });
    } else {
      // Retry until iframe appears
      requestAnimationFrame(waitForGiscusAndUpdate);
    }
  }

  // Start checking once DOM is ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", waitForGiscusAndUpdate);
  } else {
    waitForGiscusAndUpdate();
  }

  // React to theme changes (from ThemeScript or toggler)
  const observer = new MutationObserver(updateGiscusTheme);
  observer.observe(document.documentElement, { attributes: true, attributeFilter: ["class"] });
</script>
